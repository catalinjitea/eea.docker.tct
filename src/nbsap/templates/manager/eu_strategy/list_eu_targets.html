{% extends 'manager/base.html' %}

{% load i18n %}
{% load assets %}


{% block title %}
NBSAP - {% trans "EU Strategy: List Targets" %}
{% endblock %}


{% block content %}

{% get_current_language as lang_code %}
<section class="content-header">
  <h1 class="page-title">{% trans "European Strategy" %}</h1>
</section>
<section class="content">
  <h2>{% trans "List EU Targets" %}</h2>

  {% if EU_STRATEGY_ADD %}
  {% url 'edit_eu_target' as edit %}
  {% endif %}


  <table data-url="{{ edit }}" id="target-table" class="table table-striped table-bordered dataTable">

    <thead>
    <th>{% trans "Code" %}</th>
    <th>{% trans "EU Target" %}</th>
    <th>{% trans "Has actions" %}</th>
    <th></th>
    </thead>

    <tbody>
    {% for target in targets %}
    <tr>
      <td>{{ target.code }}</td>
      <td>
        <a href="{% url 'view_eu_strategy_target' target.id %}"
           title="{% trans 'Target' %} {{ target.code }}">
          {{ target.title|default:target.code }}</a>
      </td>
      <td>
        {% if starget.actions.all|length == 0 %}
        <span class="label label-danger">No</span>
        {% else %}
        <span class="label label-success">Yes</span>
        {% endif %}
      </td>
      <td>
        <form class="delete" method="POST" action="{% url 'delete_eu_strategy_target' pk=target.pk %}">
          <a class="btn btn-success"
             href="{% url 'edit_eu_strategy_target' pk=target.pk %}">{% trans "Edit" %}</a>

          <button type="submit" class="btn btn-danger edit"
                  data-message="{% trans 'Are you sure you want to delete this target?' %}">
            <i class="glyphicon glyphicon-trash"></i> {% trans "Delete" %}
          </button>
          {% if not target.parent %}
          <span class="btn btn-default edit_sub"
             href="{% url 'edit_eu_target_with_parent' parent=target.pk %}">
            {% trans "Add sub target" %}
          </span>
          {% endif %}
        </form>
      </td>
    </tr>
    {% for subtarget in target.children.all %}
    <tr>
      <td>{{ subtarget.code }}</td>
      <td>
        <a href="{% url 'view_eu_strategy_target' subtarget.id %}"
           title="{% trans 'Target' %} {{ subtarget.code }}">
          {{ subtarget.title|default:subtarget.code }}</a>
      </td>
      <td>
        {% if subtarget.actions.all|length == 0 %}
        <span class="label label-danger">No</span>
        {% else %}
        <span class="label label-success">Yes</span>
        {% endif %}
      </td>
      <td>

        <form class="delete" method="POST" action="{% url 'delete_eu_strategy_target' pk=subtarget.pk %}">

          <a class="btn btn-success"
             href="{% url 'edit_eu_strategy_target' pk=subtarget.pk %}">{% trans "Edit" %}</a>

          <button type="submit" class="btn btn-danger edit"
                  data-message="{% trans 'Are you sure you want to delete this target?' %}">
            <i class="glyphicon glyphicon-trash"></i> {% trans "Delete" %}
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}

    {% endfor %}
    </tbody>

  </table>
</section>
{% endblock %}


{% block modal %}
<div class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body">
        <p>Some text in the modal.</p>
      </div>
    </div>

  </div>
</div>
{% endblock %}
{% block scripts %}

<script>
  $(function () {
    $('#target-table').dataTable({
      "paging": false,
      "dom": '<"filter-wrapper"f>t'
    });
    var url = $('#target-table').data('url');
    $('.filter-wrapper').prepend('{% if EU_STRATEGY_ADD %}<div class="action-bar"><a class="btn btn-success add" href="' + url + '">{% trans "Add target" %}</a></div>{% endif %}');
  $('.edit_sub').on('click',function(){
  })
  });
</script>
<script src="/static/js/object_delete.js"></script>
{% endblock scripts %}

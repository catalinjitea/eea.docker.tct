{% extends 'manager/base.html' %}

{% load i18n %}
{% load utils %}

{% block title %}
  NBSAP - {% trans "Objective" %} {{ objective.code }}: {{objective.title }}
{% endblock %}


{% block content %}

  <h1 class="page-title">{% trans "Objective" %} {{ objective.code }}: {{ objective.title }}</h1>

  <div class="action-bar">
    <form method="POST" action="{% url 'delete_national_objective' pk=objective.pk %}">
      {% if objective.parent %}
      <a class="btn btn-success"
                   href="{% url 'view_national_objective' objective.parent.pk %}"><i class="glyphicon glyphicon-arrow-left"></i> {% trans "Back" %}</a>
      {% else %}
      <a class="btn btn-success"
                   href="{% url 'list_national_objectives' %}"><i class="glyphicon glyphicon-arrow-left"></i> {% trans "Back" %}</a>
      <a class="btn btn-default"
         href="{% url 'edit_national_objective' parent=objective.pk %}">{% trans "Add sub-objective" %}</a>
      {% endif %}

      <a class="btn btn-default"
         href="{% url 'edit_national_action' objective=objective.pk %}">{% trans "Add action" %}</a>

      <a class="btn btn-default"
         href="{% url 'edit_national_objective' pk=objective.pk %}">{% trans "Edit" %}</a>

      <button type="submit" class="btn btn-danger edit"
              data-message="{% trans 'Are you sure you want to delete this objective?' %}">
         <i class="glyphicon glyphicon-trash"></i> {% trans "Delete" %}
      </button>
    </form>

    {% if objective.children.exists %}
      {% assign objective.children.count as total_objectives %}
      {% assign actions.count as total_actions %}
      {% blocktrans with total_pluralized=total_objectives|pluralize %}
          <a href="#subobjectives">(<i class="glyphicon glyphicon-arrow-down"></i> {{ total_objectives }} sub-objective{{total_pluralized }})</a>
      {% endblocktrans %}
      {% blocktrans with total_pluralized=total_actions|pluralize %}
          <a href="#actions">(<i class="glyphicon glyphicon-arrow-down"></i> {{ total_actions }} action{{total_pluralized }})</a>
      {% endblocktrans %}
    {% endif %}
  </div>

  <div class="html-content">
    {{ objective.description|safe }}
  </div>

  <div id="subobjectives">
    <table class="table">

      <thead>
        <th class="span1">{% trans "Code" %}</th>
        <th>{% trans "Sub-objectives" %}</th>
      </thead>

      <tbody>
      {% for subobj in objective.children.all %}
        <tr>
          <td>{{ subobj.code }}</td>
          <td>
            <a href="{% url 'view_national_objective' pk=subobj.pk %}"
             title="{% trans 'Objective' %} {{ subobj.code }}">
            {{ subobj.title|default:subobj.code }}</a>
          </td>
          <td>
            <a href="{% url 'edit_national_objective' pk=subobj.pk %}"
               class="btn btn-xs btn-default">Edit</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="2">{% trans "No objectives" %}</td>
        </tr>
      {% endfor %}
      </tbody>

    </table>
  </div>

  <div id="actions" class="property_list">
    <table class="table table-striped minimalist">

      <thead>
        <th class="span1">{% trans "Code" %}</th>
        <th>{% trans "Actions" %}</th>
      </thead>

      <tbody>
      {% for action in actions %}
        <tr>
          <td>{{ action.code }}</td>
          <td>
            <a href="{% url 'view_national_action' objective=objective.pk pk=action.pk %}"
             title="{% trans 'Action' %} {{ action.code }}">
            {% trans "Actions related to objective" %} {{ objective.code }}
            {% if action.title %}({{ action.title }}){% endif %}</a>
          </td>
        </tr>
      {% empty %}
         <tr>
          <td colspan="2">{% trans "No actions found" %}.</td>
         </tr>
      {% endfor %}
      </tbody>

    </table>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/js/object_delete.js"></script>
{% endblock scripts %}
